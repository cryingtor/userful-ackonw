# 工控云管理系统项目管理页面解析漏洞
viewsource,查看源码:
关键:
```
<?php
     if ($_SESSION['admin']) {
       $con = $_POST['con'];
       $file = $_POST['file'];
       $filename = "backup/".$file;

       if(preg_match('/.+\.ph(p[3457]?|t|tml)$/i', $filename)){
          die("Bad file extension");
       }else{
            chdir('uploaded');
           $f = fopen($filename, 'w');
           fwrite($f, $con);
           fclose($f);
       }
     }
     ?>

    <?php
      if (isset($_GET[id]) && floatval($_GET[id]) !== '1' && substr($_GET[id], -1) === '9') {
        include 'config.php';
        $id = mysql_real_escape_string($_GET[id]);
        $sql="select * from cetc007.user where id='$id'";
        $result = mysql_query($sql);
        $result = mysql_fetch_object($result);
      } else {
        $result = False;
        die();
      }

      if(!$result)die("<br >something wae wrong ! <br>");
      if($result){
        echo "id: ".$result->id."</br>";
        echo "name:".$result->user."</br>";
        $_SESSION['admin'] = True;
      }
     ?>
```
审计,首先文件上传需要admin的session,下方需传入id进行sql查询,那么我们需要拿到admin的信息
1.floatval将字符转化为浮点数,
2.mysql_real_escape_string() 函数转义 SQL 语句中使用的字符串中的特殊字符。
下列字符受影响：
\x00
\n
\r
\
'
"
\x1a
3.substr($_GET[id], -1)
也需要绕过以上3点

使用宽字节注入
构造id=2%df' or 1=1%239,结果不行?
看了下,都是直接试出来的id=1-9

$ 匹配输入字符串结尾的位置
con处写木马,file写文件名:shell.php/.,

